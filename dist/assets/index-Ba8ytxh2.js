import{e as ee,f as te,g as V,h as ne,b as M,r as i,i as T,bH as ae,P as b,k as $,bI as re,bJ as oe,bK as ce,bL as se,j as m,c as e,R as Y,q as S,S as U,t as F,B as D,v as R,u as le,C as j,D as de,z as ie}from"./index-D7kYuqtd.js";import{M as me}from"./index-DbvvMLWa.js";import{D as H}from"./index-DcquuWwD.js";import{F as h}from"./index-Cxldnjy_.js";import{I as A}from"./index-DAOf7p35.js";import{d as I}from"./dayjs.min-SzvlDAgD.js";import{u as K}from"./loading.hook-B4xO64Zi.js";import{T as he}from"./table-CK0VyuD-.js";import{S as ue}from"./search-8bG-27XG.js";import{L as w}from"./locale-formatter-FZ-3y9Y2.js";import"./ExclamationCircleFilled-Bz7bDzj1.js";import"./InfoCircleFilled-CK2dnJYF.js";import"./index-DGwjM0Al.js";import"./index-DMzhYhmi.js";import"./index-BuPIgzdn.js";var P=(t=>(t.EditContract="Edit Contract",t.DeleteContract="Delete Contract",t.AddContract="Add Contract",t))(P||{});const N=()=>{const t=ee(""),n=te(),o=V(),d=ne(),r=M(a=>a.auth.user),c=i.useCallback(async({pageIndex:a=b.PAGEINDEX,pageSize:l=b.PAGESIZE,textSearch:g,statusId:p,time:C=I().year().toString(),roleType:E})=>{const q={PageIndex:a.toString(),PageSize:l.toString(),UserId:r==null?void 0:r.id,RoleId:r==null?void 0:r.applicationRoles[0].id,StatusId:p,Time:`1-1-${C}`,TextSearch:g,tenant:d,roleType:E},G=T(q),{data:X,succeeded:Z}=await n(()=>t.post(`/Contract/get-list-with-pagination?${G}`),{loadingKey:"get-contract"});if(Z){const{items:B,totalRecords:J,pageIndex:O,totalPages:W,totalExtend:Q}=X;o(ae({data:B,pagination:{pageIndex:O,totalRecords:J,totalPages:W},totalExtend:Q}))}},[n,t]),u=i.useCallback(async a=>{const l=$({...a}),{data:g,succeeded:p}=await n(()=>t.post(`/Contract/add-or-update?tenant=${d}`,[{data:l}]),{loadingKey:"add-contract"});return p?(o(re(g[0])),p):!1},[t,n]),y=i.useCallback(async a=>{const l=a.join(","),g=`${r==null?void 0:r.id}?tenant=${d}`,{succeeded:p}=await n(()=>t.del(`/Contract/delete-by-ids/${l}/${g}`),{loadingKey:"delete-contract"});return p!==null&&p?(o(oe(a)),!0):!1},[t,n]),f=i.useCallback(async a=>{const l=$({...a}),{data:g,succeeded:p}=await n(()=>t.post(`/Contract/add-or-update?tenant=${d}`,[{id:a.id,data:l}]),{loadingKey:"edit-contract"});return console.log("data: ",g),p?(o(ce(g[0])),p):!1},[t,n]),s=i.useCallback(async()=>{const a={UserId:r==null?void 0:r.id,RoleId:r==null?void 0:r.applicationRoles[0].id,tenant:d},l=T(a),{data:g,succeeded:p}=await n(()=>t.get(`/Customer/get-all?${l}`),{loadingKey:"get-customer"});p&&o(se({dataCustomer:g}))},[n,t,o,r,d]);return{getAllContract:c,addKContract:u,deleteContract:y,updateContract:f,getAllCustomerContract:s}},pe=({closeModal:t})=>{const[n]=h.useForm(),{addKContract:o,getAllCustomerContract:d}=N(),[r]=K(["add-contract",!1]),{dataCustomer:c}=M(s=>s.category.contract),u=async s=>{const a={...s,customerId:s.customerId.toString(),startDate:I(s.startDate).format("DD/MM/YYYY"),endDate:I(s.endDate).format("DD/MM/YYYY")};await o(a)&&(n.resetFields(),t())},y=()=>{t(),n.resetFields()};i.useEffect(()=>{d()},[d]);const f=c.map((s,a)=>({label:s.code,value:s.id,key:a}));return m(i.Fragment,{children:[e("h3",{css:ge,children:"Thêm hợp đồng"}),m(h,{form:n,css:Ce,name:"add-customer",onFinish:u,layout:"vertical",children:[m(Y,{gutter:[20,0],children:[e(S,{span:12,children:e(h.Item,{label:e("span",{css:x,children:"Mã HD"}),name:"code",rules:[{required:!0,message:"Vui lòng nhập mã KH!"}],children:e(A,{placeholder:"Nhập mã KH"})})}),e(S,{span:12,children:e(h.Item,{label:e("span",{css:x,children:"Số HD"}),name:"number",rules:[{required:!0,message:"Vui lòng nhập tên khách hàng!"}],children:e(A,{placeholder:"Nhập tên khách hàng"})})})]}),e(h.Item,{label:e("span",{css:x,children:"Mã HD"}),name:"name",rules:[{required:!0,message:"Vui lòng nhập mã KH!"}],children:e(A,{placeholder:"Nhập mã KH"})}),m(Y,{gutter:[20,0],children:[e(S,{span:12,children:e(h.Item,{label:e("span",{css:x,children:"Ngày bắt đầu"}),name:"startDate",rules:[{required:!0,message:"Vui lòng nhập ngày bắt đầu !"}],children:e(H,{css:v,format:["DD/MM/YYYY"],placeholder:"Nhập ngày bắt đầu"})})}),e(S,{span:12,children:e(h.Item,{label:e("span",{css:x,children:"Ngày kết thúc"}),name:"endDate",rules:[{required:!0,message:"Vui lòng chọn ngày kết thúc!"}],children:e(H,{css:v,format:["DD/MM/YYYY"],placeholder:"Chọn ngày kết thúc"})})})]}),e(h.Item,{label:e("span",{css:x,children:"Mã KH"}),name:"customerId",rules:[{required:!0,message:"Vui lòng nhập mã KH!"}],children:e(U,{options:f,css:v,placeholder:"Chọn khách hàng"})}),e(Y,{justify:"end",children:m(F,{children:[e(D,{onClick:y,children:"Huỷ"}),e(D,{loading:r,type:"primary",htmlType:"submit",children:"Xác nhận"})]})})]})]})},ge={name:"x2l4rd",styles:"font-weight:500;font-size:2rem;line-height:2.2rem;margin-top:2rem"},Ce={name:"1mnl6b",styles:".ant-form-item-required::before{display:none!important;}margin-top:2rem;padding:1rem"},x={name:"vu4egt",styles:"font-size:1.4rem;line-height:1.6rem;font-weight:500"},v={name:"1d3w5wq",styles:"width:100%"},ye=({closeModal:t,contractIds:n})=>{const{deleteContract:o,getAllContract:d}=N(),r=M(a=>{var l;return(l=a.category.customer.pagination)==null?void 0:l.pageIndex})??0,[c]=K(["delete-contract",!1]),u=R(),f=new URLSearchParams(u.search).get("tab");return m("div",{css:fe,children:[e("h3",{css:be,children:"Đồng ý xoá các mục tiêu đã chọn?"}),e(Y,{justify:"center",children:m(F,{children:[e(D,{onClick:()=>t(),children:"Huỷ"}),e(D,{loading:c,type:"primary",danger:!0,onClick:async()=>{await o(n)?(d({pageIndex:r||1,pageSize:b.PAGESIZE,roleType:f}),t()):console.error("Failed to delete contract")},children:"Xoá"})]})})]})},fe={name:"mjs9a",styles:"margin-top:2rem;padding:0 2rem"},be={name:"bmm6zl",styles:"font-size:1.8rem;line-height:2rem;text-align:center;margin-bottom:2.4rem;font-weight:500"},Ie=({closeModal:t,data:n})=>{const[o]=h.useForm(),{updateContract:d,getAllCustomerContract:r}=N(),[c]=K(["edit-contract",!1]),{dataCustomer:u}=M(a=>a.category.contract),y=async a=>{const l={...a,id:n.id,customerId:a.customerId.toString(),startDate:I(a.startDate).format("DD/MM/YYYY"),endDate:I(a.endDate).format("DD/MM/YYYY")};console.log("dataUpdateContract: ",l),await d(l)&&(o.resetFields(),t())},f=()=>{t()};i.useEffect(()=>{r()},[r]),i.useEffect(()=>{var a;n&&o.setFieldsValue({...n,startDate:I(n.startDate),endDate:I(n.endDate),customerId:(a=n.customer)==null?void 0:a.code})},[n]);const s=u.map((a,l)=>({label:a.code,value:a.id,key:l}));return m(i.Fragment,{children:[e("h3",{css:De,children:"Chỉnh sửa hợp đồng"}),m(h,{form:o,css:Se,name:"add-customer",onFinish:y,layout:"vertical",children:[m(Y,{gutter:[20,0],children:[e(S,{span:12,children:e(h.Item,{label:e("span",{css:k,children:"Mã HD"}),name:"code",rules:[{required:!0,message:"Vui lòng nhập mã KH!"}],children:e(A,{placeholder:"Nhập mã KH"})})}),e(S,{span:12,children:e(h.Item,{label:e("span",{css:k,children:"Số HD"}),name:"number",rules:[{required:!0,message:"Vui lòng nhập tên khách hàng!"}],children:e(A,{placeholder:"Nhập tên khách hàng"})})})]}),e(h.Item,{label:e("span",{css:k,children:"Mã HD"}),name:"name",rules:[{required:!0,message:"Vui lòng nhập mã KH!"}],children:e(A,{placeholder:"Nhập mã KH"})}),m(Y,{gutter:[20,0],children:[e(S,{span:12,children:e(h.Item,{label:e("span",{css:k,children:"Ngày bắt đầu"}),name:"startDate",rules:[{required:!0,message:"Vui lòng nhập ngày bắt đầu !"}],children:e(H,{css:z,format:["DD/MM/YYYY"],placeholder:"Nhập ngày bắt đầu"})})}),e(S,{span:12,children:e(h.Item,{label:e("span",{css:k,children:"Ngày kết thúc"}),name:"endDate",rules:[{required:!0,message:"Vui lòng chọn ngày kết thúc!"}],children:e(H,{css:z,format:["DD/MM/YYYY"],placeholder:"Chọn ngày kết thúc"})})})]}),e(h.Item,{label:e("span",{css:k,children:"Mã KH"}),name:"customerId",rules:[{required:!0,message:"Vui lòng nhập mã KH!"}],children:e(U,{options:s,css:z,placeholder:"Chọn khách hàng"})}),e(Y,{justify:"end",children:m(F,{children:[e(D,{onClick:f,children:"Huỷ"}),e(D,{loading:c,type:"primary",htmlType:"submit",children:"Xác nhận"})]})})]})]})},De={name:"x2l4rd",styles:"font-weight:500;font-size:2rem;line-height:2.2rem;margin-top:2rem"},Se={name:"1mnl6b",styles:".ant-form-item-required::before{display:none!important;}margin-top:2rem;padding:1rem"},k={name:"vu4egt",styles:"font-size:1.4rem;line-height:1.6rem;font-weight:500"},z={name:"1d3w5wq",styles:"width:100%"},_=i.createContext(void 0),L=()=>{const t=i.useContext(_);if(!t)throw new Error("useModalContract must be used within a ModalContractProvider");return t},we=({children:t})=>{const[n,o]=i.useState(),[d,r]=i.useState(!1),c=(y,f,s)=>{o({modalName:y,data:f,contractIds:s}),r(!0)},u=()=>{o(void 0),r(!1)};return m(_.Provider,{value:{openModal:c,closeModal:u},children:[t,m(me,{open:d,onCancel:u,footer:null,children:[(n==null?void 0:n.modalName)===P.EditContract&&e(Ie,{closeModal:u,data:n.data}),(n==null?void 0:n.modalName)===P.DeleteContract&&e(ye,{closeModal:u,data:n.data,contractIds:n.contractIds}),(n==null?void 0:n.modalName)===P.AddContract&&e(pe,{closeModal:u})]})]})};function Ye({data:t}){const{openModal:n}=L(),{formatMessage:o}=le(),d=c=>{switch(c){case 1:n(P.EditContract,t);break}},r=[{key:"1",label:e("span",{children:o({id:"dropdown.edit"})}),onClick:()=>d(1)}];return e(de,{menu:{items:r},placement:"bottomRight",children:e(D,{css:xe,children:e(j,{type:"three-dot",width:16,height:18})})})}const xe={name:"l2srbf",styles:"background:none;border:none;box-shadow:unset;padding:0"},ke=[{title:e(w,{id:"table.column.contractID"}),dataIndex:"code",render:t=>t},{title:e(w,{id:"table.column.contractNumber"}),dataIndex:"number",render:t=>t},{title:e(w,{id:"table.column.contractName"}),dataIndex:"name",render:t=>t},{title:e(w,{id:"table.column.contractStartDate"}),dataIndex:"startDate",render:(t,n)=>`${I(n.startDate).format("DD/MM/YYYY")} `},{title:e(w,{id:"table.column.contractEndDate"}),dataIndex:"endDate",render:(t,n)=>`${I(n.endDate).format("DD/MM/YYYY")} `},{title:e(w,{id:"table.column.contractCustomerID"}),dataIndex:["customer"],render:t=>t==null?void 0:t.code},{title:e(w,{id:"table.column.contractStatus"}),dataIndex:["contractStatus"],render:t=>t.name},{title:"",dataIndex:"calculationMethod",fixed:"right",width:"6%",render:(t,n)=>e(Ye,{data:n})}];function Ae(){const{openModal:t}=L(),{getAllContract:n}=N(),[o,d]=i.useState(),{data:r,pagination:c}=M(C=>C.category.contract);console.log("data: ",r);const[u]=K(["get-contract",!0]),y=R(),s=new URLSearchParams(y.search).get("tab"),a=({textSearch:C,time:E})=>{n({pageIndex:(c==null?void 0:c.pageIndex)??b.PAGEINDEX,pageSize:b.PAGESIZE,textSearch:C,time:E,roleType:s})},l={onChange:(C,E)=>{d(E.map(q=>q.id))}},g=C=>{n({pageIndex:C,pageSize:b.PAGESIZE,roleType:s})};i.useEffect(()=>{n({pageIndex:b.PAGEINDEX,pageSize:b.PAGESIZE,roleType:s})},[n,s]);const p=()=>{t("Delete Contract",void 0,o)};return m("div",{css:Ee,children:[m(D,{onClick:()=>t("Add Contract"),type:"primary",css:Pe,iconPosition:"start",size:"large",children:[e(j,{color:"#fff",width:16,height:16,type:"circle-plus"}),e("span",{children:"Thêm hợp đồng"})]}),e("div",{css:Me,children:e(ue,{onSearch:a})}),e("div",{css:He,children:e(D,{disabled:!o,onClick:()=>p(),size:"large",danger:!0,children:"Xoá mục tiêu đã chọn"})}),e(he,{rowSelection:l,columns:ke,dataSource:r,loading:u,rowKey:C=>C.id,onTableChange:C=>g(C),pagination:{current:c==null?void 0:c.pageIndex,pageSize:b.PAGESIZE,total:c==null?void 0:c.totalRecords,position:["bottomCenter"]},scroll:{x:1450}})]})}const Ee={name:"bjn8wh",styles:"position:relative"},Pe={name:"ngm6dc",styles:"position:absolute;right:0;top:-6.5rem;background:#0070b8;display:flex;align-items:center;gap:0.2rem;&:hover{background:#0070b8!important;opacity:0.9;}"},Me={name:"f2f29z",styles:"margin-top:2.6rem"},He={name:"vj2mbl",styles:"margin:1.1rem 0"};function Ze(){const t=V();return i.useEffect(()=>{t(ie([{title:{vi_VN:"Danh mục",en_US:"Category"}},{title:{vi_VN:"Hợp đồng",en_US:"Contract"}}]))},[t]),m(we,{children:[e("h3",{css:Ke,children:"Hợp đồng"}),e(Ae,{})]})}const Ke={name:"9czw1u",styles:"font-size:2.4rem;line-height:2.8rem;font-weight:600;color:rgba(16, 24, 40, 1);margin-bottom:0.5rem"};export{Ze as default};
//# sourceMappingURL=index-Ba8ytxh2.js.map
