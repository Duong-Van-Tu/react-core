import{e as Z,f as B,g as U,h as O,b as A,r as l,i as W,bm as J,P as C,k as K,bn as Q,bo as Y,bp as ee,j as d,c as e,t as v,B as y,R as z,v as $,u as te,C as T,D as ne,z as se}from"./index-D7kYuqtd.js";import{M as oe}from"./index-DbvvMLWa.js";import{F as b}from"./index-Cxldnjy_.js";import{I as w}from"./index-DAOf7p35.js";import{d as ae}from"./dayjs.min-SzvlDAgD.js";import{u as x}from"./loading.hook-B4xO64Zi.js";import{T as re}from"./table-CK0VyuD-.js";import{S as ce}from"./search-8bG-27XG.js";import{L as D}from"./locale-formatter-FZ-3y9Y2.js";import"./ExclamationCircleFilled-Bz7bDzj1.js";import"./InfoCircleFilled-CK2dnJYF.js";import"./index-DGwjM0Al.js";import"./index-DMzhYhmi.js";import"./index-BuPIgzdn.js";var S=(n=>(n.Edit="Edit",n.Delete="Delete Customer",n.AddCustomer="Add Customer",n))(S||{});const k=()=>{const n=Z(""),t=B(),a=U(),c=O(),s=A(r=>r.auth.user),o=l.useCallback(async({pageIndex:r=C.PAGEINDEX,pageSize:m=C.PAGESIZE,textSearch:h,statusId:u,time:E=ae().year().toString(),roleType:p})=>{const I={PageIndex:r.toString(),PageSize:m.toString(),UserId:s==null?void 0:s.id,RoleId:s==null?void 0:s.applicationRoles[0].id,StatusId:u,Time:`1-1-${E}`,TextSearch:h,tenant:c,roleType:p},P=W(I),{data:H,succeeded:L}=await t(()=>n.post(`/Customer/get-list-with-pagination?${P}`),{loadingKey:"get-customer"});if(L){const{items:q,totalRecords:V,pageIndex:X,totalPages:_,totalExtend:M}=H;a(J({data:q,pagination:{pageIndex:X,totalRecords:V,totalPages:_},totalExtend:M}))}},[t,n]),i=l.useCallback(async r=>{const m=K({...r}),{data:h,succeeded:u}=await t(()=>n.post(`/Customer/add-or-update?tenant=${c}`,[{data:m}]),{loadingKey:"add-customer"});return u?(a(Q(h[0])),u):!1},[n,t]),g=l.useCallback(async r=>{const m=r.join(","),h=`${s==null?void 0:s.id}?tenant=${c}`,{succeeded:u}=await t(()=>n.del(`/Customer/delete-by-ids/${m}/${h}`),{loadingKey:"delete-customer"});return u!==null&&u?(a(Y(r)),!0):!1},[n,t]),f=l.useCallback(async r=>{const m=K({...r}),{data:h,succeeded:u}=await t(()=>n.post(`/Customer/add-or-update?tenant=${c}`,[{id:r.id,data:m}]),{loadingKey:"edit-customer"});return u?(a(ee(h[0])),u):!1},[n,t]);return{getAllCustomer:o,addKCustomer:i,deleteCustomer:g,updateCustomer:f}},ie=({closeModal:n})=>{const[t]=b.useForm(),{addKCustomer:a}=k(),[c]=x(["add-customer",!1]),s=async i=>{const g={...i};await a(g)&&(t.resetFields(),n())},o=()=>{n(),t.resetFields()};return d(l.Fragment,{children:[e("h3",{css:le,children:"Thêm khách hàng"}),d(b,{form:t,css:de,name:"add-customer",onFinish:s,layout:"vertical",children:[e(b.Item,{label:e("span",{css:F,children:"Mã KH"}),name:"code",rules:[{required:!0,message:"Vui lòng nhập mã KH!"}],children:e(w,{placeholder:"Nhập mã KH"})}),e(b.Item,{label:e("span",{css:F,children:"Tên khách hàng"}),name:"fullname",rules:[{required:!0,message:"Vui lòng nhập tên khách hàng!"}],children:e(w,{placeholder:"Nhập tên khách hàng"})}),e(z,{justify:"end",children:d(v,{children:[e(y,{onClick:o,children:"Huỷ"}),e(y,{loading:c,type:"primary",htmlType:"submit",children:"Xác nhận"})]})})]})]})},le={name:"x2l4rd",styles:"font-weight:500;font-size:2rem;line-height:2.2rem;margin-top:2rem"},de={name:"1mnl6b",styles:".ant-form-item-required::before{display:none!important;}margin-top:2rem;padding:1rem"},F={name:"vu4egt",styles:"font-size:1.4rem;line-height:1.6rem;font-weight:500"},me=({closeModal:n,customerIds:t})=>{const{deleteCustomer:a,getAllCustomer:c}=k(),s=A(m=>{var h;return(h=m.category.customer.pagination)==null?void 0:h.pageIndex})??0,[o]=x(["delete-customer",!1]),i=$(),f=new URLSearchParams(i.search).get("tab");return d("div",{css:he,children:[e("h3",{css:ue,children:"Đồng ý xoá các mục tiêu đã chọn?"}),e(z,{justify:"center",children:d(v,{children:[e(y,{onClick:()=>n(),children:"Huỷ"}),e(y,{loading:o,type:"primary",danger:!0,onClick:async()=>{await a(t)?(c({pageIndex:s||1,pageSize:C.PAGESIZE,roleType:f}),n()):console.error("Failed to delete customer")},children:"Xoá"})]})})]})},he={name:"mjs9a",styles:"margin-top:2rem;padding:0 2rem"},ue={name:"bmm6zl",styles:"font-size:1.8rem;line-height:2rem;text-align:center;margin-bottom:2.4rem;font-weight:500"},pe=({closeModal:n,data:t})=>{const[a]=b.useForm(),{updateCustomer:c}=k(),[s]=x(["edit-customer",!1]),o=async g=>{const f={...g,id:t.id};await c(f)&&(a.resetFields(),n())},i=()=>{n()};return l.useEffect(()=>{a.setFieldsValue(t)},[t]),d(l.Fragment,{children:[e("h3",{css:ge,children:"Chỉnh sửa khách hàng"}),d(b,{form:a,css:fe,name:"add-kpi",onFinish:o,layout:"vertical",children:[e(b.Item,{label:e("span",{css:j,children:"Mã KH"}),name:"code",rules:[{required:!0,message:"Vui lòng nhập mã KH!"}],children:e(w,{placeholder:"Nhập mã KH"})}),e(b.Item,{label:e("span",{css:j,children:"Tên khách hàng"}),name:"fullname",rules:[{required:!0,message:"Vui lòng nhập tên khách hàng!"}],children:e(w,{placeholder:"Nhập tên khách hàng"})}),e(z,{justify:"end",children:d(v,{children:[e(y,{onClick:i,children:"Huỷ"}),e(y,{loading:s,type:"primary",htmlType:"submit",children:"Xác nhận"})]})})]})]})},ge={name:"x2l4rd",styles:"font-weight:500;font-size:2rem;line-height:2.2rem;margin-top:2rem"},fe={name:"1mnl6b",styles:".ant-form-item-required::before{display:none!important;}margin-top:2rem;padding:1rem"},j={name:"vu4egt",styles:"font-size:1.4rem;line-height:1.6rem;font-weight:500"},R=l.createContext(void 0),G=()=>{const n=l.useContext(R);if(!n)throw new Error("useModalCustomer must be used within a ModalCustomerProvider");return n},Ce=({children:n})=>{const[t,a]=l.useState(),[c,s]=l.useState(!1),o=(g,f,r)=>{a({modalName:g,data:f,customerIds:r}),s(!0)},i=()=>{a(void 0),s(!1)};return d(R.Provider,{value:{openModal:o,closeModal:i},children:[n,d(oe,{open:c,onCancel:i,footer:null,children:[(t==null?void 0:t.modalName)===S.Edit&&e(pe,{closeModal:i,data:t.data}),(t==null?void 0:t.modalName)===S.Delete&&e(me,{closeModal:i,data:t.data,customerIds:t.customerIds}),(t==null?void 0:t.modalName)===S.AddCustomer&&e(ie,{closeModal:i})]})]})};function ye({data:n}){const{openModal:t}=G(),{formatMessage:a}=te(),c=o=>{switch(o){case 1:t(S.Edit,n);break}},s=[{key:"1",label:e("span",{children:a({id:"dropdown.edit"})}),onClick:()=>c(1)}];return e(ne,{menu:{items:s},placement:"bottomRight",children:e(y,{css:be,children:e(T,{type:"three-dot",width:16,height:18})})})}const be={name:"l2srbf",styles:"background:none;border:none;box-shadow:unset;padding:0"},Ie=[{title:e(D,{id:"table.column.customersID"}),dataIndex:"code",render:n=>n},{title:e(D,{id:"table.column.customersName"}),dataIndex:"fullname",render:n=>n},{title:"",dataIndex:"calculationMethod",fixed:"right",width:"6%",render:(n,t)=>e(ye,{data:t})}];function Se(){const{openModal:n}=G(),{getAllCustomer:t}=k(),[a,c]=l.useState(),{data:s,pagination:o}=A(p=>p.category.customer),[i]=x(["get-customer",!0]),g=$(),r=new URLSearchParams(g.search).get("tab"),m=({textSearch:p,time:I})=>{t({pageIndex:(o==null?void 0:o.pageIndex)??C.PAGEINDEX,pageSize:C.PAGESIZE,textSearch:p,time:I,roleType:r})},h={onChange:(p,I)=>{c(I.map(P=>P.id))}},u=p=>{t({pageIndex:p,pageSize:C.PAGESIZE,roleType:r})};l.useEffect(()=>{t({pageIndex:C.PAGEINDEX,pageSize:C.PAGESIZE,roleType:r})},[t,r]);const E=()=>{n("Delete Customer",void 0,a)};return d("div",{css:we,children:[d(y,{onClick:()=>n("Add Customer"),type:"primary",css:xe,iconPosition:"start",size:"large",children:[e(T,{color:"#fff",width:16,height:16,type:"circle-plus"}),e("span",{children:"Thêm khách hàng"})]}),e("div",{css:ke,children:e(ce,{onSearch:m})}),e("div",{css:Ee,children:e(y,{disabled:!a,onClick:()=>E(),size:"large",danger:!0,children:"Xoá mục tiêu đã chọn"})}),e(re,{rowSelection:h,columns:Ie,dataSource:s,loading:i,rowKey:p=>p.id,onTableChange:p=>u(p),pagination:{current:o==null?void 0:o.pageIndex,pageSize:C.PAGESIZE,total:o==null?void 0:o.totalRecords,position:["bottomCenter"]},scroll:{x:1450}})]})}const we={name:"bjn8wh",styles:"position:relative"},xe={name:"1vjzj34",styles:"position:absolute;right:0;top:-9rem;background:#0070b8;display:flex;align-items:center;gap:0.2rem;&:hover{background:#0070b8!important;opacity:0.9;}"},ke={name:"f2f29z",styles:"margin-top:2.6rem"},Ee={name:"vj2mbl",styles:"margin:1.1rem 0"};function Le(){const n=U();return l.useEffect(()=>{n(se([{title:{vi_VN:"Danh mục",en_US:"Category"}},{title:{vi_VN:"Khách hàng",en_US:"Customer"}}]))},[n]),d(Ce,{children:[e("h3",{css:Pe,children:"Khách hàng"}),d("div",{css:N,children:[e(T,{width:8,height:8,type:"dot"}),e("span",{children:e("span",{css:N,children:"10 Khách hàng"})})]}),e(Se,{})]})}const Pe={name:"9czw1u",styles:"font-size:2.4rem;line-height:2.8rem;font-weight:600;color:rgba(16, 24, 40, 1);margin-bottom:0.5rem"},N={name:"q29gn3",styles:"font-size:1.2rem;font-weight:500;line-height:1.8rem;color:rgba(84, 104, 129, 1)"};export{Le as default};
//# sourceMappingURL=index-RYJCk0gZ.js.map
