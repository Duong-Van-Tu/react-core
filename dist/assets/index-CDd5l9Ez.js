import{b as k,v as te,j as o,c as e,t as B,B as w,R as g,P as R,r as p,S as N,q as r,u as F,y as H,h as U,C as L,D as ne,a as _,w as X,x as ie,g as se,z as oe,T as le}from"./index-D7kYuqtd.js";import{T as ae}from"./table-CK0VyuD-.js";import{L as v}from"./locale-formatter-FZ-3y9Y2.js";import{M as re}from"./index-DbvvMLWa.js";import{b as I}from"./modal.enum-Dk0fWDyJ.js";import{u as $}from"./loading.hook-B4xO64Zi.js";import{u as G}from"./relationship.service-B_Vy62zW.js";import{F as S}from"./index-Cxldnjy_.js";import{I as A}from"./index-DAOf7p35.js";import{T as ce}from"./index-Dnrrwy9u.js";import{b as j}from"./status.enum-khnHdRij.js";import{M as he}from"./message-CTVHhzE_.js";import{S as de}from"./search-8bG-27XG.js";import{R as C}from"./role.enum-2GZE6esB.js";import"./index-DGwjM0Al.js";import"./index-DMzhYhmi.js";import"./index-BuPIgzdn.js";import"./ExclamationCircleFilled-Bz7bDzj1.js";import"./InfoCircleFilled-CK2dnJYF.js";import"./dayjs.min-SzvlDAgD.js";const pe=({closeModal:n,relationshipIds:t,data:s})=>{const{deleteRelationship:l,getAllRelationship:h}=G(),d=k(y=>{var q;return(q=y.sale.kpi.pagination)==null?void 0:q.pageIndex})??0,[i]=$(["delete-relationship",!1]),c=te(),m=new URLSearchParams(c.search).get("tab");return o("div",{css:me,children:[e("h3",{css:ue,children:"Đồng ý xoá quyền lợi đã chọn?"}),e(g,{justify:"center",children:o(B,{children:[e(w,{onClick:()=>n(),children:"Huỷ"}),e(w,{loading:i,type:"primary",danger:!0,onClick:async()=>{await l(s?[s.id]:t)&&(n(),t.length===R.PAGESIZE&&h({pageIndex:d-1||1,pageSize:R.PAGESIZE,roleType:m}))},children:"Xoá"})]})})]})},me={name:"mjs9a",styles:"margin-top:2rem;padding:0 2rem"},ue={name:"bmm6zl",styles:"font-size:1.8rem;line-height:2rem;text-align:center;margin-bottom:2.4rem;font-weight:500"},ge=({closeModal:n})=>{const{getListCustomer:t,addRelationship:s,getAllLevel:l}=G(),[h]=$(["add-relationship",!1]),[d]=S.useForm(),{customer:i,level:c}=k(a=>a.sale.relationship),f=k(a=>a.auth.user),m=p.useMemo(()=>i==null?void 0:i.map(a=>({value:a.id,label:a.fullname})),[i])??[],u=p.useMemo(()=>c==null?void 0:c.map(a=>({value:a.id,label:a.code})),[c])??[],y=async a=>{const{point:E}=a,z={...a,point:E.toString(),applicationUserId:f==null?void 0:f.id};await s(z)&&(d.resetFields(),n())},q=()=>{n()};return p.useEffect(()=>{t(),l()},[t,l]),o(p.Fragment,{children:[e("h3",{css:ye,children:" Thêm đề xuất mối quan hệ"}),o(S,{form:d,css:fe,name:"add-Relationship",onFinish:y,layout:"vertical",children:[e(S.Item,{label:e("span",{css:x,children:"Công ty"}),name:"customerId",rules:[{required:!0,message:"Vui lòng nhập công ty!"}],children:e(N,{size:"middle",placeholder:"Chọn công ty",options:m})}),e(S.Item,{label:e("span",{css:x,children:"Họ tên khách hàng"}),name:"customerName",rules:[{required:!0,message:"Vui lòng nhập họ tên khách hàng!"}],children:e(A,{size:"middle",placeholder:"Nhập họ tên khách hàng"})}),e(S.Item,{label:e("span",{css:x,children:"Vị trí"}),name:"position",rules:[{required:!0,message:"Vui lòng nhập vị trí!"}],children:e(A,{size:"middle",placeholder:"Nhập vị trí"})}),o(g,{gutter:[20,0],children:[e(r,{span:12,children:e(S.Item,{label:e("span",{css:x,children:"Mối quan hệ hiện tại"}),name:"currentRelationshipId",rules:[{required:!0,message:"Vui lòng nhập mối quan hệ hiện tại!"}],children:e(N,{size:"middle",options:u,placeholder:"Nhập mối quan hệ hiện tại"})})}),e(r,{span:12,children:e(S.Item,{label:e("span",{css:x,children:"Mối quan hệ mục tiêu"}),name:"targetRelationshipId",rules:[{required:!0,message:"Vui lòng nhập mối quan hệ mục tiêu!"}],children:e(N,{size:"middle",options:u,placeholder:"Nhập mối quan hệ mục tiêu"})})})]}),e(S.Item,{label:e("span",{css:x,children:"Lý do cần phải nâng cấp quan hệ"}),name:"reason",rules:[{required:!0,message:"Vui lòng nhập lý do cần phải nâng cấp quan hệ!"}],children:e(A.TextArea,{size:"middle",placeholder:"Nhập lý do cần phải nâng cấp quan hệ"})}),e(S.Item,{label:e("span",{css:x,children:"Điểm mục tiêu"}),name:"point",rules:[{required:!0,message:"Vui lòng nhập điểm mục tiêu!"}],children:e(ce,{css:be,size:"middle",placeholder:"Nhập điểm mục tiêu"})}),e(g,{justify:"end",children:o(B,{children:[e(w,{onClick:q,children:"Huỷ"}),e(w,{loading:h,type:"primary",htmlType:"submit",children:"Xác nhận"})]})})]})]})},fe={name:"1qwb3s7",styles:".ant-form-item-required::before{display:none!important;}margin-top:2rem;padding:1rem;.ant-form-item{margin-bottom:1.4rem;}"},ye={name:"x2l4rd",styles:"font-weight:500;font-size:2rem;line-height:2.2rem;margin-top:2rem"},x={name:"166bhmq",styles:"font-size:1.4rem;line-height:1.6rem;font-weight:500;color:#101828"},be={name:"1d3w5wq",styles:"width:100%"},Se=({closeModal:n,data:t})=>{var l;let s;switch(t==null?void 0:t.relationshipStatus.code){case j.Completed:s="success";break;case j.Pending:case j.Processing:s="info";break;default:s="warning"}return o("div",{css:Re,children:[e("h3",{css:we,children:"Báo cáo đề xuất mối quan hệ với khách hàng"}),o("div",{css:Ie,children:[o(g,{justify:"space-between",children:[e(r,{children:"Họ và tên"}),e(r,{children:(l=t==null?void 0:t.applicationUser)==null?void 0:l.fullName})]}),o(g,{justify:"space-between",children:[e(r,{children:"Vị trí làm việc"}),e(r,{children:t==null?void 0:t.position})]}),o(g,{justify:"space-between",children:[e(r,{children:"Mức độ QH hiện tại"}),e(r,{children:t==null?void 0:t.currentRelationshipLevel})]}),o(g,{justify:"space-between",children:[e(r,{children:"Mức độ QH mục tiêu"}),e(r,{children:t==null?void 0:t.targetRelationshipLevel})]}),o(g,{justify:"space-between",children:[e(r,{children:"Lý do cần phải nâng cấp quan hệ"}),e(r,{children:t==null?void 0:t.reason})]}),o(g,{justify:"space-between",children:[e(r,{children:"Điểm mục tiêu"}),e(r,{children:t==null?void 0:t.point})]}),o(g,{justify:"space-between",align:"bottom",children:[e(r,{children:e(v,{id:"title.status"})}),e(r,{children:t.relationshipStatus?e(he,{hasBackground:!0,type:s,children:t.relationshipStatus.name}):""})]}),e(w,{css:xe,type:"primary",onClick:()=>n(),children:"Xác nhận"})]})]})},Re={name:"1dvcxr3",styles:"padding:1rem"},Ie={name:"fnbsfe",styles:"display:flex;flex-direction:column;gap:1.4rem;font-weight:500"},we={name:"ft4w6g",styles:"margin-top:2rem;font-size:2rem;line-height:2.8rem;text-align:center;margin-bottom:2rem;font-weight:500"},xe={name:"1729r8f",styles:"width:100%;margin-top:2rem"},Z=p.createContext(void 0),Q=()=>{const n=p.useContext(Z);if(!n)throw new Error("useModalRelationship must be used within a ModalRelationshipProvider");return n},ve=({children:n})=>{const[t,s]=p.useState(),[l,h]=p.useState(!1),d=(c,f,m)=>{s({modalName:c,data:f,relationshipIds:m}),h(!0)},i=()=>{s(void 0),h(!1)};return o(Z.Provider,{value:{openModal:d,closeModal:i},children:[n,o(re,{width:(t==null?void 0:t.modalName)===I.DeleteRelationship?"38rem":(t==null?void 0:t.modalName)===I.ReportRelationship?"50rem":"54rem",open:l,onCancel:i,footer:null,children:[(t==null?void 0:t.modalName)===I.DeleteRelationship&&e(pe,{closeModal:i,data:t.data,relationshipIds:t.relationshipIds}),(t==null?void 0:t.modalName)===I.AddRelationship&&e(ge,{closeModal:i}),(t==null?void 0:t.modalName)===I.ReportRelationship&&e(Se,{closeModal:i,data:t.data})]})]})};function Ce({data:n}){const{openModal:t}=Q(),{formatMessage:s}=F(),l=H(),h=U(),d=c=>{switch(c){case 0:t(I.ReportRelationship,n);break}},i=[{key:"1",label:e("span",{children:s({id:"title.dropdown.relationship.update"})}),onClick:()=>l(`/sales/relationship/gains/${n==null?void 0:n.id}?tenant=${h}`)},{key:"2",label:e("span",{children:s({id:"title.dropdown.relationship.evaluate"})}),onClick:()=>l(`/sales/relationship/relationshipGainsQuestion/${n==null?void 0:n.id}?tenant=${h}`)},{key:"3",label:e("span",{children:s({id:"title.dropdown.relationship.report"})}),onClick:()=>d(0)}];return e(ne,{menu:{items:i},placement:"bottomRight",children:e(w,{css:qe,children:e(L,{type:"three-dot",width:16,height:18})})})}const qe={name:"l2srbf",styles:"background:none;border:none;box-shadow:unset;padding:0"},T=[{title:e(v,{id:"table.column.relationship.jobPosition"}),dataIndex:"position"},{title:e(v,{id:"table.column.relationship.targetLevel"}),dataIndex:"targetRelationshipLevel"},{title:e(v,{id:"table.column.relationship.upgrade"}),dataIndex:"reason"},{title:e(v,{id:"table.column.relationship.responsiblePerson"}),dataIndex:["applicationUser","firstName"]},{title:e(v,{id:"table.column.targetPoint"}),dataIndex:"point",render:n=>n},{title:e(v,{id:"table.column.status"}),dataIndex:["relationshipStatus","name"],render:n=>n},{title:"",dataIndex:"calculationMethod",fixed:"right",width:"6%",render:(n,t)=>e(Ce,{data:t})}];function D(){const{getAllRelationship:n,getAllStatusRelationship:t}=G(),{openModal:s}=Q(),[l,h]=$(["get-relationship",!0],["status-relationship",!0]),{data:d,pagination:i,status:c,totalExtend:f}=k(b=>b.sale.relationship),{isSaleDirector:m,isSale:u}=_(),[y,q]=p.useState(),{tab:a,textSearch:E,time:z,statusId:V}=X(),O=p.useMemo(()=>m&&a===C.MySelf?T==null?void 0:T.slice(1):T,[a,m]),W={onChange:(b,P)=>{q(P.map(M=>M.id))}},J=({textSearch:b,statusId:P,time:M})=>{n({pageIndex:(i==null?void 0:i.pageIndex)??R.PAGEINDEX,pageSize:R.PAGESIZE,textSearch:b,statusId:P,time:M,roleType:a})},Y=b=>{n({pageIndex:b,pageSize:R.PAGESIZE,roleType:a,textSearch:E?decodeURI(E).replace(/\+/g," "):void 0,time:z,statusId:V})};p.useEffect(()=>{n({pageIndex:R.PAGEINDEX,pageSize:R.PAGESIZE,roleType:a}),t()},[n,t,a]);const ee=u?Ee:K;return o("div",{css:ke,children:[(m||u)&&a!==C.Employee&&o(w,{onClick:()=>s(I.AddRelationship),type:"primary",css:ee,iconPosition:"start",size:"large",children:[e(L,{color:"#fff",width:16,height:16,type:"circle-plus"}),e("span",{children:"Thêm mối quan hệ"})]}),e("div",{css:ze,children:e(de,{onSearch:J,status:c,loadingStatus:h})}),o(g,{css:Te,justify:"space-between",align:"bottom",children:[e(r,{children:e(w,{onClick:()=>s(I.DeleteRelationship,void 0,y),disabled:!y,size:"middle",danger:!0,children:"Xoá mối quan hệ đã chọn"})}),o(r,{children:["Tổng điểm đạt được: ",f??0]})]}),e(ae,{rowSelection:W,columns:O,dataSource:d,loading:l,rowKey:b=>b.id,onTableChange:b=>Y(b),pagination:{current:i==null?void 0:i.pageIndex,pageSize:R.PAGESIZE,total:i==null?void 0:i.totalRecords,position:["bottomCenter"]},scroll:{x:1450}})]})}const ke={name:"bjn8wh",styles:"position:relative"},K={name:"1vjzj34",styles:"position:absolute;right:0;top:-9rem;background:#0070b8;display:flex;align-items:center;gap:0.2rem;&:hover{background:#0070b8!important;opacity:0.9;}"},Ee=ie(K," top:-5rem;",""),Te={name:"5bn9ws",styles:"margin:2.4rem 0 1.4rem 0"},ze={name:"f2f29z",styles:"margin-top:2.6rem"};function Ye(){const n=H(),t=se(),{formatMessage:s}=F(),{isAdmin:l,isSaleDirector:h}=_(),d=U(),i=k(u=>{var y;return(y=u.sale.relationship.pagination)==null?void 0:y.totalRecords}),{tab:c}=X(),f=[{key:l?C.Manager:C.MySelf,label:l?"Mối quan hệ của giám đốc":s({id:"title.tab.relationship.my"}),children:e(D,{})},{key:C.Employee,label:s({id:"title.tab.relationship.employee"}),children:e(D,{})}],m=u=>{n(`?tab=${u}&tenant=${d}`)};return p.useEffect(()=>{c||n(`?tab=${l?C.Manager:C.MySelf}&tenant=${d}`)},[c]),p.useEffect(()=>{t(oe([{title:{vi_VN:"Sale",en_US:"Sale"}},{title:{vi_VN:"Mối quan hệ",en_US:"relationship"}}]))},[t]),o(ve,{children:[e("h3",{css:Me,children:s({id:"title.document.relationship"})}),o("div",{css:Pe,children:[e("span",{children:s({id:"title.document.relationship"})}),e(L,{width:8,height:8,type:"dot"}),o("span",{children:[i," ",s({id:"title.document.relationship"})]})]}),(l||h)&&e(le,{activeKey:c,items:f,onChange:m}),!(l||h)&&e(D,{})]})}const Pe={name:"1scp1f2",styles:"display:flex;align-items:center;gap:4px;font-size:1.4rem"},Me={name:"156m3vd",styles:"font-size:1.8rem;line-height:2.3rem;font-weight:600"};export{Ye as default};
//# sourceMappingURL=index-CDd5l9Ez.js.map
